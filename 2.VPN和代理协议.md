### 注意: 本内容仅提供给除中国大陆以外的人观看, 此外如你所在国家或地区中的法律或规定不允许使用或学习, 请不要查看!!

### 免责声明: 本内容仅提供给允许使用VPN/代理等内容的国家或地区的人, 如违反责任自行承担, 本账号以及账号持有者以及Github和微软概不负责!

VPN协议对VPN服务性能有着至关重要的作用，因为它决定了你使用VPN时的网络连接速度，隐私性和安全性。
如果你还对VPN常用协议一无所知，不知道如何选择，请仔细阅读这篇文章。当您更好地了解了这十大主流VPN协议后，您必将会受益匪浅。

虚拟专用网络服务，又称VPN，是当下广大网民实现在线匿名，保护网络隐私安全的首选方式。
之前我们通过了解VPN的工作原理明白了VPN协议在整个VPN使用行为过程的作用。简单来说，当使用VPN传输数据时，为了确保数据的私密性，
必须使用更安全的隧道协议来加密数据从而达到保密的效果，而这个“安全的隧道协议”就是我们本文的主角——VPN协议。

**什么是VPN协议？为什么它如此重要？**

VPN协议字面意思就是VPN使用的传输协议。广义来说，只要是VPN服务内置的协议都可以称作VPN协议。
但是严格来讲，VPN协议仅特指那些有加密功能的仅仅能在虚拟专用网使用协议，如OpenVPN。
提到这两种定义标准的意义在于，在某些代理使用率较高的区域如亚洲部分区域，用户很容易讲“代理协议”和“VPN协议”混淆。
混淆原因之一在于部分用户分不清VPN和代理的差别，误以为两者是同一个东西，从而类推出，此两种协议也是等同的；
原因之二在于一些 VPN 厂商会因为地域需求将代理协议加入其VPN协议范畴，让代理协议成为了广义上的VPN协议。

那么VPN协议究竟为何物？想要更简单的了解VPN协议的含义和作用，我们先来看看计算机领域协议的概念。
在计算机科学中，协议，又称网络协议或网络传输协议（communication protocol），
是一套用于确定数据如何在同一网络中的不同设备之间进行传输的既定规则。
只能当双方都遵循同一个规则后才可以实现通信交流。VPN协议是这样一组规则，
它决定用户和网络请求终端如何通过虚拟专用网络传输数据，从本地设备的VPN客户端到VPN厂商的服务器，
从VPN服务器到目标互联网地址，反之亦然。整个过程中的数据都通过“VPN 隧道”传输。除了特有的隧道技术，
数据加密解密技术、密匙管理技术和身份认证技术也都有被应用到VPN的工作中。

协议对VPN来说意义重大，因为它不仅决定了数据的路由方式，还一定程度决定了数据的加密程度。
不同的协议有不同的规范和优劣势，最终直接反应到网速、在线隐私、和安全性

**PPTP（点对点隧道协议）**

PPTP的英文全称是Point to Point Tunneling Protocol，是拨号时代的初生代VPN通信协议，
由微软开发，最早同Windows 95 OSR2一起于1996年发布，一直沿用至今。它同时使用TCP和GRE来完成PPP数据包的封装和传输。

PPTP从发布之初开始就被因为安全性能低的弱点被诟病。一开始的PPTP并没有加密授权特性，
只能依靠PPP (Point-to-Point Protocol点对点协议) 的MPPE实现加密保护。
即使后面MPPE升级实现了RSA RC4算法，支持128位密匙，仍拥有诸多安全漏洞，
很容易被（国家安全局等）解密攻破并受到（字典/暴力）攻击。
为此，部分VPN厂商已经弃之不用。即使仍有一些VP 因为其良好的稳定性和连接速度将其延用，
当用户有敏感或重要信息需要保护的时候，PPTP也并不建议选择。

优点：速度快，平台支持度高，易配置
缺点：安全系数低，容易被防火墙阻挡，被第三方攻破

**IPSec**

IPSec全名Internet Protocol Security，是通过分组IP协议并对其进行加密和安全认证的协议集合，是常用的VPN协议之一，
用以有效保证安全的加密Internet通信。IPsec网络传输协议族主要包括安全协议认证头AH（Authentication Header）、
封装安全载荷ESP（Encapsulating Security Payload）和因特网密匙交换IKE (Internet Key Exchange）。
它们协同工作以验证源并锁定 IP 数据包，从而建立受保护的连接。

IPSec可以作为VPN服务的协议独立工作，不仅适用于多台机器之间入口对入口的通信，
还可用于端对端的分组通信。由于本身缺失加密机制，通常与上述的IKEv2或L2TP组合使用。

优点：网络层保护，无需依赖独立应用，无兼容问题
缺点：安全系数低，服务器负载高

**IKEv2 / IPSec**

Internet Key Exchange version 2，是上述IPsec协议套件的一部分。
独特的MOBIKE功能确保了VPN连接的稳定性，因为它不会受到任何可能的网络变化的影响。
作为由微软和思科/Cisco联合开发的IKE的最新版本，
该VPN协议通常通过在IPSec身份验证套件内在VPN客户端和VPN服务器之间创建安全关联/SA来屏蔽流量，就此出现了IKEv2/IPsec。

IKEv2/IPsec不仅安全，而且连接快速。因此，许多VPN应用程序已经被利用，
估计更多的VPN将利用该协议来提供快速和私密的网络浏览。

优点：速度快，稳定，安全性较高，易配置
缺点：可被防火墙阻挡，闭源

**L2TP / IPSec**

L2TP又叫第2层隧道协议，是上述PPTP的继承者，因为本身让没有加密功能，为了提高安全级别，通常与IPSec一起实施以添加加密。
这使得该协议组的工作速度比任何单个协议（如 OpenVPN）都要慢。

L2TP / IPsec很容易设置。但由于它绕过防火墙的能力不强，当你想解锁某个区域的任何互联网过滤器时，L2TP/IPSec并不是首选。
知名的VPN厂商如NordVPN已经在2018年底停止了对PPTP和L2TP的支持。

优点：设备 & 系统兼容性高，安全性较高，容易设置
缺点：速度较慢，可被防火墙阻挡

**SSTP**

SSTP，中文名安全套接字隧道协议，是另一种有微软早期开发的VPN专用隧道协议，伴随Windows Vista面世。
SSTP通过使用SSL/TLS来传输PPP流量，从而给用户提供了传输级别的安全性。
此外，对TCP端口443（默认）的支持有助于使流量成功通过大多数防火墙和代理。
由于是微软专有协议，它被广泛认为是对Windows更友好的协议，但仍然对Mac和Linux友好。

作为Microsoft的协议，与OpenVPN等开源协议相比，SSTP拒绝任何独立审核。
更重要的是，这个TCP式的隧道协议在带宽不足的情况可能会出现TCP崩溃错误。
所以想要让SSTP产出闪电般的速度，请保证足够的带宽。

优点：安全系数高，可绕过诸多防火墙，支持多种加密
缺点：Windows 运行更佳，会出现 TCP 断线/崩溃

**OpenVPN**

OpenVPN是一种开源、跨平台、也是目前最常用的VPN加密协议，没有之一。
它使用OpenSSL加密库的SSL/TLS进行密钥交换，以便严密保护点对点或站点到站点连接，并且通过将数据分成小包来传输数据。

OpenVPN又可分为两种OpenVPN TCP和OpenVPN UDP，前者更侧重网络安全而后者拥有更好的连接速度。

这里OpenVPN TCP当然通过TCP隧道传输，所有数据包都按顺序传递。与以流形式传送数据包的UDP相比，
它具有较慢的速度（当互联网连接不稳定时会发生延迟）但具有更高的加密方式、更好的可靠性并且能够绕过非常严格的防火墙，
由于它非常难以被检测和阻止例如443端口，它像SSL流量一样在线发送数据，而不是VPN端口。换句话说，
它更适合日常在线行为，如网页浏览、购物、文件发送和电子邮件。OpenVPN TCP只有在带宽充足的情况下才能正常工作。
否则，会意外出现已知的TCP崩溃问题。

如果您需要VPN服务来解锁/加速在线游戏、流式传输高清电影和电视、实时聊天/会议或P2P种子下载，
可以使用OpenVPN TCP的替代协议OpenVPN UDP。因为相较OpenVPN TCP, OpenVPN UDP拥有更快的速度，实现低延迟传输，
同时仍然提供出色的安全性和匿名性。这就是为什么许多VPN将OpenVPN UDP设置为默认配置以向用户提供更好的用户体验的原因。

OpenVPN UPD对比OpenVPN TCP，谁更好？当下尚无绝对定论谁优于谁，建议您根据具体需求选取最合适的。

优点：开源协议且经过第三方审计，安全性高，支持各种加密算法，可绕过防火墙
缺点：不能独立使用，需要依靠第三方软件，设置较复杂，更适合桌面端

**WireGuard**

WireGuard是一种比较新的开源VPN协议。
由于它的开发目的就是在性能、易用性和省电等方面全面超越当下流行的IKEv2/IPsec和OpenVPN，
因此许多人将WireGuard称为”VPN协议的未来“。而已有实际测试已经证明WireGuard（使用 UDP）确实比OpenVPN TCP和UDP都快，
而且ping值和延迟更低。并且，与其它具有复杂加密算法的通用VPN协议不同，WireGuard只是重新组装了现成的算法，
以实现更简单但仍然安全的加密目标。具体来说，其前沿的密码学用法包括Noise协议框架、ChaCha20、Curve25519等。

WireGuard最初只支持Linux，现在已经变成了可在Windows、macOS、iOS、Android等多平台使用。
尽管如此，它仍在开发更新中，这意味着当下版本还是有一定程度的安全风险。

优点：速度超快，轻便，工作效率高，省电，易搭建配置，不容易被封锁
缺点：目前主流 VPN 支持度不高，尚在持续开发

**SoftEther（SSL-VPN）**

SoftEther VPN实际是一个由日本程序员在硕士毕业时开发的类似于OpenVPN的VPN程序方案，
有VPN服务器、客户端、桥接器、命令行攻击等公共组成，已于2014年变成了开源软件。它能越过各种防火墙，
支持NAT穿刺，并支持多种VPN协议，包括上面提到的OpenVPN, L2TP，IPsec，SSTP和自身的SSL VPN协议。
或许亚洲部分区域用户很少听到这个协议，那是因为该区域的很多地区都已对此协议流量进行了屏蔽，所以根本无法使用。

优点：速度快，可穿过防火墙，开源
缺点：VPN 软件支持少

**Lightway**

在这个列表里，Lightway比较特别，因为它是唯一一个由行业领先的VPN提供商Express建立的只属于自己的VPN协议，
以实现更便捷、更轻松、更快、更安全且更可靠的VPN连接。它真的很“小巧”，
只有大约1000行代码（OpenVPN有70000行代码，尽管小巧的WireGuard也有4000行）。

至于密码学，它利用wolfSSL（一个嵌入式SSL/TLS库）来提供安全通信。
无论网络发生任何变化、流失或故障，保护始终处于开启状态。
根据官方声明，他们将在将来开放这个VPN协议的核心库，使其更加透明，并进行进一步的安全审计。

优点：安全，快速，省电，轻便
缺点：暂不支持 iOS

**Shadowsocks**

Shadowsocks是一种免费且开源的加密代理/VPN协议。它是一款基于Socks5的代理协议，
最早由亚洲某审查严重国家的程序员开发，主要应用于绕过政府防火墙/GFW审查。Shadowsocks, 
又叫飞机，酸酸，影梭，曾经由作者clowwindy发布于GitHub代码库。尽管后来受官方压力，
Shadowsocks所有代码库和信息已于2015年被他关闭和删除，但仍有一群开发爱好者一直对其进行维护和更新。
后面还延申初了更多的代理协议，例如V2Ray和Trojan

相较于OpenVPN，WireGuard等一流VPN协议，此类代理协议安全性能还是无法相提并论，
使用它们泄露IP地址和其他重要信息的概率会大幅增加。

优点：隐匿性较强，安全，支持多种加密算法，速度相对较快，可穿透防火墙，开源
缺点：第三方软件支持较少，自己搭建较复杂

**VPN协议总结**

（由于lightway目前是ExpressVPN独有，就不参与到以下top 3指标”竞选”）：

- 最快的 VPN 协议 TOP 3：PPTP、Wireguard、IKEv2/IPsec
- 最安全的 VPN 协议 TOP 3：OpenVPN (TCP/UDP)、Wireguard、SSTP
- 最佳游戏 VPN 协议 TOP 3：L2TP/IPSec、IKEv2/IPsec、WireGuard
- 最适合流媒体的 VPN 协议 TOP 3：OpenVPN UDP、L2TP/IPsec、PPTP
- 最适合种子下载分享的 VPN 协议 TOP 3：L2TP/IPSec、IKEv2/IPsec、OpenVPN UDP

注意：这些排名仅供参考，每个VPN协议的实际性能会因VPN、服务器配置和网络状况而异。
最后声明：我们不提倡将VPN用于非法侵犯版权等行为，您最好查看您所在国家/地区的相关法律，以防您遇到任何意外情况。

**Shadowsocks协议运行原理**

Shadowsocks的运行原理与其他代理工具基本相同，使用特定的中转服务器完成数据传输。
例如，用户无法直接访问Google，但代理服务器可以访问，且用户可以直接连接代理服务器，
那么用户就可以通过特定软件连接代理服务器，然后由代理服务器获取网站内容并回传给用户，
从而实现代理上网的效果。服务器和客户端软件会要求提供密码和加密方式，双方一致后才能成功连接。
连接到服务器后，客户端会在本机构建一个本地Socks5代理（或VPN、透明代理等）。浏览网络时，
客户端通过这个Socks5（或其他形式）代理收集网络流量，然后再经混淆加密发送到服务器端，
以防网络流量被识别和拦截，反之亦然

**Shadowsocks特点**

- Shadowsocks使用自行设计的协议进行加密通信。加密算法有AES-GCM、ChaCha20-Poly1305等，
除创建TCP连接外无需握手，每次请求只转发一个连接，无需保持“一直连线”的状态，因此在移动设备上相对较为省电。
- 所有的流量都经过算法加密，允许自行选择算法。
- Shadowsocks通过异步I/O和事件驱动程序运行，响应速度快。
- 客户端覆盖多个主流操作系统和平台，包括Windows、macOS、Android、Linux和iOS系统和路由器（OpenWrt）等。
2017年9月21日，一篇名为《The Random Forest based Detection of Shadowsock’s Traffic》的论文在IEEE发表，
该论文介绍了通过随机森林算法检测Shadowsocks流量的方法，并自称可达到85％的检测精度，
虽然该论文的有效性遭到网友质疑。但是使用机器学习来识别网络流量特征的做法被认为是可行的，
而且还适用于任何网络代理协议而不仅仅局限于Shadowsocks。

Shadowsocks在SIP003提案[25]中支持了插件，插件让Shadowsocks的流量可以通过不同的插件进行混淆加密或其他处理。
目前使用较多的插件有v2ray-plugin、simple-obfs等

**Shadowsocks协议的实现**

目前Shadowsocks有多个实现支持，以自由软件形式发布的主要有：

原始Shadowsocks（以Python语言编写）

Shadowsocks-libev

openwrt-Shadowsocks

Shadowsocks-rust

go-shadowsocks2

gost

libQtShadowsocks

Shadowsocks-qt5

Shadowsocks-android

Shadowsocks-windows

ShadowsocksX-NG

ShadowsocksR

Outline

V2Ray

Brook

Trojan

Clash

等等，还有为数甚多的免费软件及商业软件

**ShadowsocksR协议**

ShadowsocksR（简称SSR）是网名为breakwa11的用户发起的Shadowsocks分支，
在Shadowsocks的基础上增加了一些资料混淆方式，称修复了部分安全问题并可以提高QoS优先级。
后来贡献者Librehat也为Shadowsocks补上了一些此类特性，甚至增加了类似Tor的可插拔传输层功能。

ShadowsocksR开始时曾有过违反GPL、发放二进制时不发放源码的争议，使得原开发作者不满。
不过后来ShadowsocksR项目由breakwa11转为了与Shadowsocks相同的GPL、Apache许可证、MIT许可证等多重自由软件许可协议。

2017年7月19日，ShadowsocksR作者breakwa11在Telegram频道ShadowsocksR news里转发了深圳市启用SS协议检测的消息
并被大量用户转发，引发恐慌。7月24日，breakwa11发布了闭源的SS被动检测程序，引发争议。
7月27日，breakwa11遭到自称“ESU.TV”（恶俗TV）的不明身份人士人身攻击，
对方宣称如果不停止开发并阻止用户讨论此事件将发布更多包含个人隐私的资料，
随后breakwa11表示遭到对方人肉搜索并公开个人资料的是无关人士，为了防止对方继续伤害无关人士，
breakwa11将删除GitHub上的所有代码、解散相关交流群组，停止ShadowsocksR项目。但项目已被多人fork，
并有人在其基础上继续发布新的版本，例如较为知名的SSRR（ShadowsocksRR）。

**Trojan协议**

与Shadowsocks相反，Trojan不使用自定义的加密协议来隐藏自身。相反，使用特征明显的TLS协议(TLS/SSL)，
使得流量看起来与正常的HTTPS网站相同。TLS是一个成熟的加密体系，HTTPS即使用TLS承载HTTP流量。
使用正确配置的加密TLS隧道，可以保证传输的

- 保密性（GFW无法得知传输的内容）
- 完整性（一旦GFW试图篡改传输的密文，通讯双方都会发现）
- 不可抵赖（GFW无法伪造身份冒充服务端或者客户端）
- 前向安全（即使密钥泄露，GFW也无法解密先前的加密流量）
- 
对于被动检测，Trojan协议的流量与HTTPS流量的特征和行为完全一致。
而HTTPS流量占据了目前互联网流量的一半以上，且TLS握手成功后流量均为密文，
几乎不存在可行方法从其中分辨出Trojan协议流量。

对于主动检测，当防火墙主动连接Trojan服务器进行检测时，Trojan可以正确识别非Trojan协议的流量。
与Shadowsocks等代理不同的是，此时Trojan不会断开连接，而是将这个连接代理到一个正常的Web服务器。
在GFW看来，该服务器的行为和一个普通的HTTPS网站行为完全相同，无法判断是否是一个Trojan代理节点。
这也是Trojan推荐使用合法的域名、使用权威CA签名的HTTPS证书的原因: 
这让你的服务器完全无法被GFW使用主动检测判定是一个Trojan服务器

**V2Ray工具**

V2Ray，是Victoria Raymond以及其社区团队开发的Project V下的一个工具。
Project V是一个工具集合，号称可以帮助其使用者打造专属的基础通信网络。
Project V的核心工具称为V2Ray，其主要负责网络协议和功能的实现，与其它Project V通信。
V2Ray可以单独运行，也可以和其它工具配合，以提供简便的操作流程。开发过程主要使用Go语言，Core采用MIT许可证并开放源代码。

在大陆，本工具广泛用于突破防火长城（GFW），以访问被封锁和屏蔽的内容。

V2Ray的运行原理与其他代理工具基本相同，使用特定的中转服务器完成数据传输。
例如，用户无法直接访问Google，YouTube等网站，但代理服务器可以访问，且用户可以直接连接代理服务器，
那么用户就可以通过特定软件连接代理服务器，然后由代理服务器获取网站内容并回传给用户，从而实现代理上网的效果。
服务器和客户端软件会要求提供用户ID（GUID）和加密方式，双方一致后才能成功连接（VMess协议能够自适应客户端采用的加密方式）
连接到服务器后，客户端会在本机构建一个本地Socks5代理（或VPN、HTTP、透明代理等）。
浏览网络时，客户端通过这个Socks5（或其他形式）代理收集网络流量，然后再经混淆加密发送到服务器端，
以防网络流量被识别和拦截，反之亦然。V2Ray 定位为一个平台，任何开发者都可以利用 V2Ray 提供的模块开发出新的代理软件

**V2Ray主要特性**

- 多入口多出口：一个V2Ray进程可并发支持多个入站和出站协议，每个协议可独立工作。
- 定制化路由：入站流量可按配置由不同地出口发出。轻松实现按区域或按域名分流，以达到最优的网络性能。
- 多协议支持：V2Ray 可同时开启多个协议支持，包括Socks、HTTP、Shadowsocks、VMess、Trojan和VLESS等。
每个协议可单独设置传输载体，比如TCP、mKCP和WebSocket等。
- 隐蔽性：V2Ray的节点可以伪装成正常的网站（HTTPS），将其流量与正常的网页流量混淆，以避开第三方干扰。
- 反向代理：通用的反向代理支持，可实现内网穿透功能。
- 多平台支持：原生支持所有常见平台，如Windows、macOS和Linux，并已有第三方支持移动平台

**VMess协议**

VMess是一个无状态协议，即客户端和服务器之间不需要握手即可直接传输数据，
每一次数据传输对之前和之后的其它数据传输没有影响。
VMess的客户端发起一次请求，服务器判断该请求是否来自一个合法的客户端。
如验证通过，则转发该请求，并把获得的响应发回给客户端。VMess使用非对称格式，
即客户端发出的请求和服务器端的响应使用了不同的格式

**Shadow TLS协议**

一个可以使用别人的受信证书的TLS伪装代理。

它和trojan的表现类似，但它在做真实TLS握手的同时，可以直接使用别人的受信证书（如某些大公司或机构的域名），
而不需要自己签发证书。当直接使用浏览器打开时，可以正常显示对应可信域名的网页内容

**Xray-core新协议Reality**

如果用REALITY取代传统的TLS服务，可以消除服务端TLS指纹特征，同时保留前向保密性等功能，  
证书链攻击也无效。这样的安全性超越了常规的TLS  

使用REALITY可以指向别人的网站，无需自己购买域名和配置TLS服务端，更为方便。  
同时，实现了向中间人呈现指定SNI的全程真实TLS  

通常用于代理的目的，目标网站最低标准是支持TLSv1.3和H2的国外网站，域名非跳转使用（主域名可能被用于跳转到 www）  
加分项包括：目标IP与代理IP相近（更像，且延迟低），在Server Hello后的握手消息中一起加密（如dl.google.com），  
有OCSP Stapling  

在配置方面，禁止回国流量，并转发TCP/80和UDP/443等端口（REALITY对外表现为端口转发，目标IP冷门或许更佳）  

REALITY也可以搭配XTLS以外的代理协议使用，但不建议这样做，因为它们存在明显且已被针对的TLS in TLS特征  
REALITY的下一个主要目标是“预先构建模式”，即提前采集目标网站特征，XTLS的下一个主要目标是0-RTT，REALITY不支持套CDN  

- 在设计上就把安全等级拉满，限制人的可控范围，最大程度降低人为因素的影响  
- 信任服务端，客户端不可信，甚至默认客户端持有的节点信息全泄露了  
- 服务端对客户端是有选择的，比如拒绝版本过低的Xray-core连接，防止过时的客户端实现不当害了服务端，比如指纹过时  
- 以后服务端还可以带信息给客户端，告知客户端有新版了/告知客户端版本过低，要求更新，否则多长时间后不再支持  

**XTLS Vision协议**  

XTLS的核心逻辑在于使用真实的TLS将代理流量隐藏于互联网最常见的流量之中  
对于普通TLS代理协议（比如原版Trojan），用户的代理客户端与代理服务器建立一个真实的TLS连接，通过这个加密的隧道，  
应用程序（比如浏览器）再与目标服务器（比如 Google）建立一个TLS连接。  
这时浏览器与Google服务器就是端对端加密，任何人（包括代理服务）不能解密或者伪装发送信息，这就是所谓的e2e  

浏览器----代理客户端====代理服务器----Google  

代理数据经过审查者的时候其实经过了2次加密，而RPRX敏锐的发现在这个过程中99%的流量其实是不需要做额外加密的。  
因为经过TLS 1.3加密的数据在外观上是完全一致的，审查者无法分辨。也就是说代理逻辑只需要：  

- 建立一条真实TLS链接  
- 在加密隧道内，跟踪浏览器与Google之间的通信，识别当前的通信是否为TLS 1.3  
- 如不是，则使用普通TLS代理方法，继续使用加密隧道  
- 如是，则等待两端开始传输加密数据，代理客户端在第一个内层加密包中插入UUID，指示代理服务端：我们准备裸奔了！  
- 从第二个内层加密包之后，XTLS就不再对数据包做任何操作，只是单纯拷贝  

这就是 xtls-rprx-vision，我们可以发现  

代理发起的外层TLS是真实的，所以审查者无法破解  
裸奔的流量在代理方面只做单纯拷贝，如果审查者进行任何破坏，将会得到浏览器与Google服务器的正常alert响应，与一般访问无异  
裸奔的信号是UUID，此信号是代理私有信息，以避免类似 关于23 3 3判断部分的代码特征的利用漏洞Go#17的漏洞  

10月3日开始大规模识别和封锁TLS代理，透过一些相关讨论及内幕信息，我们知道审查者使用了海量资源以及机器学习的方法  
众所周知，机器学习的特长在于从海量数据中提取统计学特征  
引用klzgrad的话，普通TLS代理的一个重要弱点就是加密套娃。上面讨论提及，虽然加密包的外观对于审查者无法分辨，  
但加密套娃无可避免的一点就是在每个包都会增加一个数据包头，加密层数越多，包头就会越重  
这个增量虽然不大，但对于小数据（比如应答包）可能比较明显，而且会有一些包长超过网络底层的MTU限制。  
最重要的，由于每个包都增加了相同长度，它可能具有某些统计学特征。  

RPRX当年发明XTLS主要原因是为了减少额外加密，现在推出新流控Vision，则是因为XTLS在对抗审查者有独特的能力。  
可以说，当传输TLS 1.3数据时XTLS 99%的数据包，拥有几乎完美的流量特征。因为它是原始数据，没有经过任何代理加工  

为什么说99%的数据包都是原始数据？那1%究竟是什么？  
我们需要继续探索一个典型的代理在遇到内部TLS 1.3流量的时候，最开始是几个包究竟在干什么  
形象的看，当加密通道建立以后：

第一个包 		 代理客户端 -> 代理服务器  		"你好 本次代理访问的目标地址是 Google 这里是我的 UUID"  
第二个包 		 代理客户端 <- 代理服务器  		"你好 收到了你的代理请求 请开始发送数据"  
第三个包 	浏览器 -> 代理客户端 -> 代理服务器 -> Google 	"你好 Google 我将和你进行加密通话 我支持的加密方式有。。" (这个包也叫 TLS Client Hello)  
第四个包 	浏览器 <- 代理客户端 <- 代理服务器 <- Google 	"你好 用户 这是 Google 证书 本次将使用TLS_AES_128_GCM_SHA256 加密 让我们开始加密通话！" (这个包也叫 TLS Server Hello)  
第五个包 	浏览器 -> 代理客户端 -> 代理服务器 -> Google 	"收到 让我们开始加密通话！"  

你所知道的代理协议万变不离其宗，只要用户使用了任何TLS连接，都需要进行上述的握手过程。  
前面提到，外层TLS加密后可以认为是绝对安全的，但对于审查者而言，除了破解信息以外，  
还可以利用一些附加信息来识别这5个包。这就是所谓TLS in TLS检测的关键点  

最明显的特征，是这5个包的长度

第一个包 	很短 	唯一的变数是目标地址  
第二个包 	很短 	几乎固定  
第三个包 	短 	变化很少 几乎唯一的变数是目标 SNI  
第四个包 	长 	变化较大  
第五个包 	很短 	变化很少  

可以直观的感受到，它们的包长特征其实是十分明显的。在Vision中，应对方法也十分简单，  
就是将每一个短包的长度填充至900到1400这么一个区间。注意，这个方法与传统的随机填充不同，  
我们不是盲目的在所有包都加上填充，而是基于我们对内部流量的分析，有针对性的，对TLS握手过程的标志性的包进行填充  

另一个比较隐蔽的特征叫做时序特征。受限于TLS握手的设计，你可以注意到，前面这几个包的顺序是固定的。  
也就是说，浏览器发送TLS Client Hello之后，必须等待Google发出TLS Server Hello这一信息，  
而这之后浏览器又必须发送一个”收到 让我们开始加密通话！”，如此后面的对话才可以正常进行。  

如果把用户到服务端发一个包叫做C，反方向一个包叫做S。审查者是否能够根据CSCSC这种数据时序，它们的时间间隔特征来判定这是一个TLS in TLS连接？  

我们认为现在还不足以下结论，Vision并没有在这个方面做处理  

有很多开发者都提到MUX多路复用对抗TLS in TLS检测。它在这方面的确有混淆作用，假如多路复用两个不同的TLS连接在一个隧道里，  
就有机会会形成CCSSCC等各种不同的时序特征  

可以预期，翻墙的技术战争将从shadowsocks（加密）->主动探测->TLS->机器学习  
继续升级，是生存或者死亡，将很大程度上取决于这5个包的处理

问：Vision 的填充长度是写死的，是不是也有统计学特征？  

答：首先网络安全概念上没有绝对的安全，理论上讲任何加密都可以暴力破解，只是计算量（投入资源）大小而已  
作为安全协议的设计者，我们只需要把破解和识别的难度提高到审查者无法企及的高度即可，  
这个高度是多高？恐怕需要在战争拉锯中我们才能知晓  
回到我们已知的信息，TLS 1.2和1.3握手包的长度分布是非常稳定的  
几个关键包访问主流网站（比如Google）可以看作是固定长度。如果把Vision现有的大包随机长度，  
跟不加填充的握手包相比，识别难度应当会增加一个数量级  
另外，在一些泄露出来的讨论中，有人提到机器学习可以识别低于40%的随机填充。这可以侧面证明机器学习存在辨识上限  

问：为什么新流控取名Vision

答：Vision代表了RPRX原本的设计理念。XTLS初版事实上是在探索中开发的，而且受限于当时的开发环境，  
有一些地方过于复杂，可以说，Vision代表了XTLS的理想形态和未来方向  

问：新流控这么好，你们推荐所有人都使用它翻墙吗

答：正如其它开发者所言，对于当前的审查者，把所有鸡蛋都放在一个篮子里是十分危险的。  
所以我们鼓励大家善用每个工具的特性，分散特征。  

问：对于未来你推荐国密比如sm4吗？

答：不推荐，正如一开始提到，我们认为最安全的方法就是隐藏于互联网中最常见的流量之中。  
除了HTTPS以外，我们应该考虑什么样的出国流量是常见的。SSH？Remote Desktop？  
微信视频？Email（雾）？电波通信（大雾）？而不是使用一个极其小众的加密和协议  

其实基于TLS的代理在2017年就有相当成熟的应用了。2019年大规模封锁Shadowsocks服务以来，可以想见，
审查者投入了极大人力物力算力，用了至少3年时间，才有了今天的技术。而截至目前的情况，我们看到仍然有误封，
CDN大半存活，IPV6存活，以及从Xray项目的访问量以及telegram群在线人数屡创新高的情况来看，
审查者本次阻绝信息的效果，实际上十分有限

![198920972-d3aca5cc-03e3-4bcc-a30a-5b8e82e39f65](https://github.com/LingLing1301/lingling1301.github.io/assets/65935235/d1e16341-10f0-4d91-a4ac-b4676426da15)

可以毫不夸张的说，”破铜烂铁“的志愿者队伍，Shadowsocks，*ray，Trojan，Naive，Hystaria，Tuic，Sing，  
在此之前一直把审查者按在地上摩擦，还是花式的。  

TLS代理战争才刚刚开始，审查者之所以要动用AI手段，恰恰从侧面证明了以前的审查方式，  
包括主动检测对于TLS代理都是无效的。而我们面对AI对手，必须要在细节层面做的更好。  
我们可以充分发挥己方的长处，集思广益，开源，分散特征。具体而言，作为代理工具和服务，  
可以直接过滤内层流量，这其实是我们对审查者的一个天然优势。利用这个信息差，  
Vision的逻辑可以对关键的TLS握手包进行填充。这个思路跟NaiveProxy针对一些特定包的填充是一致的  

[参考]

https://www.vpn-china.org/detailed-explanation-of-top-ten-vpn-protocols/

https://www.vpn-china.org/history-of-several-airport-agreements/

https://v2xtls.org/xray%E6%96%B0%E5%8D%8F%E8%AE%AEreality%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/

https://v2xtls.org/xtls-vision%E4%BB%8B%E7%BB%8D%E5%8F%8A%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/
