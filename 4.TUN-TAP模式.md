### 注意: 本内容仅提供给除中国大陆以外的人观看, 此外如你所在国家或地区中的法律或规定不允许使用或学习, 请不要查看!!

### 免责声明: 本内容仅提供给允许使用VPN/代理等内容的国家或地区的人, 如违反责任自行承担, 本账号以及账号持有者以及Github和微软概不负责!

**TUN**

对于不遵循系统代理的软件，TUN模式可以接管其流量并交由CFW处理，在 indows中，TUN 模式性能比TAP模式好

TUN 设备是一种虚拟网络设备，通过此设备，程序可以方便地模拟网络行为。TUN模拟的是一个三层设备,也就是说,
通过它可以处理来自网络层的数据，更通俗一点的说，通过它，我们可以处理IP数据包
![1918847-496d0e96c237f25a](https://github.com/LingLing1301/lingling1301.github.io/assets/65935235/241c3d94-195a-4820-9991-a8f9560102d0)

上图中的 eth0 表示我们主机已有的真实的网卡接口 (interface)。

网卡接口 eth0 所代表的真实网卡通过网线(wire)和外部网络相连，
该物理网卡收到的数据包会经由接口eth0传递给内核的网络协议栈(Network Stack)。然后协议栈对这些数据包进行进一步的处理。

对于一些错误的数据包,协议栈可以选择丢弃；对于不属于本机的数据包，协议栈可以选择转发；
而对于确实是传递给本机的数据包,而且该数据包确实被上层的应用所需要，协议栈会通过 Socket API 告知上层正在等待的应用程序

![1918847-85ea08bc89d9427e](https://github.com/LingLing1301/lingling1301.github.io/assets/65935235/6668f3de-965b-459f-a2ff-77b865f05825)
![1918847-92c47952b6f7fdd6](https://github.com/LingLing1301/lingling1301.github.io/assets/65935235/a7f91307-5493-4596-b7e9-3b3b2802f890)

我们知道，普通的网卡是通过网线来收发数据包的话，而TUN设备比较特殊，它通过一个文件收发数据包。

如上图所示，tunX和上面的eth0在逻辑上面是等价的，tunX也代表了一个网络接口,虽然这个接口是系统通过软件所模拟出来的.

网卡接口tunX所代表的虚拟网卡通过文件/dev/tunX与我们的应用程序(App)相连，
应用程序每次使用write之类的系统调用将数据写入该文件，这些数据会以网络层数据包的形式，
通过该虚拟网卡，经由网络接口tunX传递给网络协议栈，
同时该应用程序也可以通过read之类的系统调用，经由文件/dev/tunX读取到协议栈向tunX传递的所有数据包。

此外，协议栈可以像操纵普通网卡一样来操纵tunX所代表的虚拟网卡。
比如说，给tunX设定IP地址，设置路由，总之，在协议栈看来，tunX所代表的网卡和其他普通的网卡区别不大，
当然，硬要说区别，那还是有的,那就是tunX设备不存在MAC地址，这个很好理解，tunX只模拟到了网络层，
要MAC地址没有任何意义。当然，如果是tapX的话，在协议栈的眼中，tapX和真是网卡没有任何区别。

如果我们使用TUN设备搭建一个基于UDP的VPN ，那么整个处理过程可能是这幅样子：

![1918847-ac4155ec7e9489b2](https://github.com/LingLing1301/lingling1301.github.io/assets/65935235/5d7a62bf-6062-43ac-8dba-e5bd5063a6b6)

首先，我们的应用程序通过eth0和远程的UDP程序相连,对方传递过来的UDP数据包经由左边的协议栈传递给了应用程序，
UDP数据包的内容其实是一个网络层的数据包，比如说IP数据报，应用程序接收到该数据包的数据（剥除了各种头部之后的UDP数据）之后，
然后进行一定的处理，处理完成后将处理后的数据写入文件/dev/tunX，这样，数据会第二次到达协议栈。需要注意的是，
上图中绘制的两个协议栈其实是同一个协议栈，之所以这么画是为了叙述的方便

**TAP**

对于不遵循系统代理的软件，TAP模式可以接管其流量并交由CFW(Clash for Windows)处理

TAP与TUN工作方式完全相同，区别在于：

TUN设备是一个三层设备，它只模拟到了IP层，即网络层。我们可以通过/dev/tunX文件收发IP层数据包，它无法与物理网卡做bridge，
但是可以通过三层交换（如 ip_forward）与物理网卡连通。可以使用ifconfig之类的命令给该设备设定IP地址。
TAP设备是一个二层设备，它比TUN更加深入，通过/dev/tapX文件可以收发MAC层数据包，即数据链路层，拥有MAC层功能，
可以与物理网卡做bridge，支持MAC层广播。同样的，我们也可以通过ifconfig之类的命令给该设备设定IP地址，
你如果愿意，我们可以给它设定MAC地址。

**路由规则**

“AsIs”：
只使用域名进行路由选择。快速解析，不精确分流。默认值。

“IPIfNonMatch”：
当域名没有匹配任何规则时，将域名解析成IP（A 记录或 AAAA 记录）再次进行匹配；
当一个域名有多个A记录时，会尝试匹配所有的A记录，直到其中一个与某个规则匹配为止；
解析后的IP仅在路由选择时起作用，转发的数据包中依然使用原始域名；
理论上解析比”AsIs”稍慢，但使用中通常不会觉察到。

“IPOnDemand”：
当匹配时碰到任何基于IP的规则，将域名立即解析为IP进行匹配。解析最精确，也最慢。

**代理集**

如果你购买了机场，那么一般机场都会提供给你一堆的代理节点，
此时我们就可以对这些节点按照一定的规则进行归类，这些个归类后的节点称之为代理集（proxy-providers）

**策略组**

策略组这个名字有点让人望而却步，个人认为译为“代理组”会更好理解一点。策略组的作用就是对代理集进行自由组合使用，
当然它还提供了定时测速选择最优节点或者手动选择节点等功能

**规则**

规则决定了访问指定地址时使用哪个代理，也就是我们说的分流规则

最后我们来看下代理如何分流。一行分流策略包含两部分，请求+代理。
请求可以来自于规则集匹配，代理则可以来自于策略组。没有匹配到规则的网路请求如果使用代理访问则称为白名单模式，
直接请求不经过代理则是黑名单模式。

我们自定义的分流策略也一般定义在此处

**规则集**

规则负责将指定网络请求丢给指定的的代理去处理，仿佛左手请求，右手代理。那么首先要确定的就是网络请求，
网络请求的界定既可以是一个特定的域名或者IP，也可以是特定域名结尾或者开头，亦或者是进程名称。
我们一般将一组特定相关的请求归类到一起，称为规则集。这些规则往往都是爱好者们整理好开源在Github上并定期维护的，
我们直接拿来用就可以了

**代理核心**

Clash是一个使用Go语言编写，基于规则的跨平台代理软件核心程序。
Clash for Windows是目前在Windows上唯一可用的图形化Clash分支。通过Clash API来配置和控制Clash核心程序，
便于用户可视化操作和使用。
支持的协议： Vmess, Shadowsocks, Snell , SOCKS5 , ShadowsocksR（在 0.11.2 版本加入）

[SingBox](https://github.com/SagerNet/sing-box)是一个使用Go语言编写的新兴的代理核心，
支持多种协议，包括Vmess, Shadowsocks, Snell , SOCKS5 , ShadowsocksR等等

[Xray](https://github.com/XTLS/Xray-core)Xray-core 是v2ray-core的超集，含更好的整体性能和XTLS等一系列增强，
且完全兼容 v2ray-core 的功能及配置。只有一个可执行文件，含ctl的功能，run为默认指令。配置上完全兼容，
环境变量和API对应要改为以XRAY_开头，全平台开放了裸协议的ReadV。提供完整的VLESS&Trojan XTLS支持，均有ReadV。
提供了XTLS多种流控模式, 性能一骑绝尘!

[v2fly](https://github.com/v2fly/v2ray-core)V2Ray可同时开启多个协议支持，
包括Socks、HTTP、Shadowsocks、Trojan、Vmess、VLESS等。
每个协议可单独设置传输载体，比如TCP、mKCP、QUIC、gPRC和WebSocket等。

V2Ray是Project V下的一个工具。Project V是一个包含一系列构建特定网络环境工具的项目，
而V2Ray属于最核心的一个。官方介绍中Project V提供了单一的内核和多种界面操作方式。内核（V2Ray）用于实际的网络交互、
路由等针对网络数据的处理，而外围的用户界面程序提供了方便直接的操作流程。不过从时间上来说，先有V2Ray才有Project V。
如果还是不理解，那么简单地说，V2Ray是一个与Shadowsocks类似的代理软件，可以用来科学上网（翻墙）学习国外先进科学技术。

**如何选择适合自己的机场**

这里看你是需要下载还是日常使用，对于一般人来说中端的中转机场就是够用的，对于老手来说可能需要好一些的专线机场，
这里咱们就按照不同的需求来说一下怎么选择机场。

对于高端用户来说，建议使用一线顶级机场，目前约到了奶昔，买到了tag和花云，后期可能还加上yooto，
不过顶级机场的博客我慢慢写，大家不要着急。可以去看一下奶昔还有花云等等，这几家都超级贵，当然效果也是非常的好，
可以说是就算是专线，这几家不止有沪港专线，还有沪日/沪德等专线。对于有专业需求的人/预算足足够的人来说，可以去看一下，
很抱歉博主买不起这几家的订阅。对于次一等的高端用户来说，他们只需要稳定的线路和流媒体，同时在特殊时期不掉网，
这里可以看一下我发的中高端机场排行，有专线的我会特意标注，我推荐的专线机场都是性价比不错的。
像是猫熊还有bitz都是特别好的专线机场，沪港线路以及沪港线路转发的全球线路，使用起来很不错，流媒体也是有保证的。
当然这种机场同样也有着非常高的稳定性，能保证平时以及特殊时期还能上网，具体的特点大家可以点进具体的每个机场介绍。

对于中端用户来说，这里是最难选择的，telegram有很多很多的中转机场。
同时也有很多中转机场达到甚至超过我推荐的专线机场的价格，这里需要注意的是。2022年下半年开始很多月抛机器都死的差不多，
中转商家上更多类型的中转机就代表着成本大幅度提高。同样中端用户也有着很强烈的流媒体需求，所以这种机场很难推荐，
还是推荐大家上一些人数比较多的中转机场。tnt/奇异/xfss等等，能在我博客看到的中转机场都是我挑选过的，
这些中转机场都有自己不同的特点，可能有的速度快，有的节点多，有的速度慢但是稳定/人数多/开的时间长，
这个就需要点进文章自己详细看一下，是否有这方面的需求。这个是最难最难推荐的。

同样，中端中转机场都是性价比比较高的，也就代表可能会有或多或少的缺点，
我还是建议更高预算的用户直接上专线而不是在大厂的中转里面挑选，当然我后期也会上几个大厂的有很多中转线路的中转机场放上来，
以供大家选择。每家中端中转机场都有自己的特点，这点需要大家去挑选是否适合自己。

对于低端用户来说，追求速度的同时也就放弃了更多的稳定性。但是这也是相对的，低端用户通常有着两方面的需求。
一是套餐价格低流量正常，二是套餐价格正常但是流量给的多，其实反而是第一种套餐比较难选择，这种机场也是比较不稳定的。
大流量的机场其实有很多，奇异/追风岛/宝贝云网等等。追求套餐低价的用户最近也看到了，有几家机场很难发展下去，
可以看一下我首页置顶的第二个文章，低价中转机场推荐。这里的都是比较灵车的但是还不错的低端中转机场。

对于下载用户来说，我更建议他们选择直连机场。这里有几方面的考虑。第一点是流量的低价，
同样的价格更多的流量对于下载用户来说是更友好的，这里直连机场由于选择的是月抛的az/aws，就导致下载时性价比特别的高。
第二是速度，对于直连机场来说，通常就是没有速度和速度起飞两个情况，挑选适合自己的节点会让你的下载变得非常快。
第三就是有利于机场发展，有很多机场你搞多线程下载的话，会在晚高峰时期让中转机满载，让其他用户使用困难，
甚至你会被机场主删号或者限制账号速度，这点是机场主和我们都不能接受的。当然这里并不是建议大家都去买直连机场，
直连机场可以说只适合下载和预算实在低的大流量用户。

还有一种用户，他们需要备用机场，可能几个月都不会用到。这就是按量使用的机场。这个其实是非常难选择的，
因为这种机场由于很多用户都是一次性付费，所以成本回收困难，这种套餐价格通常也是同质量机场月付套餐的几倍。
所以很多机场都不做按量套餐，甚至开了一段时间之后跑路或者转型。这里其实推荐的按量机场很少，以前还有两家，现在暂时就一家。
以后我会尽量选择一些比较稳定的比较贵的按量机场推荐给大家作为备用机场使用。

**免流机场**

很多人问，为什么免流节点都是vmess的，因为SS和SSR一般不能免流使用，trojan由于协议不完全，也做不了免流。
vmess可以，并且由于国内的网站和免流环境，vmess节点需要根据免流端口来设置端口，80端口，有些8080的。
并且使用ws协议，不开tls。所以你看的免流机场协议都是vmess。有些纯国内节点免流的，不是机场，叫做云免，
用的openvpn，原理也类似

关于免流的运营商和端口

这个分地区，基本上来说，电信和联通的定向流量是可以免流的，移动基本不能免流，不要尝试用移动免流了。
而电信连接国外的免流节点速度比较慢，如果你只用国内免流，那么用电信和联通都是可以的。
联通以前还能手厅免流，现在基本也都和电信一样，是通过定向流量来免流。比如抖音定向和大王卡的腾讯定向等等，
博主个人使用的是33元的钉钉不限流量定向。而关于端口，这个也分地区，有些地区是全端口免流，
也就是同一个IP的任何一个端口都能免流，也有的地区只能80/443/8080免流，博主这里就是限制端口的免流，
所有我通常只用80端口免流的节点
 
为什么我需要自己配置免流域名？  
有很多朋友需要问，为什么机场不提供直接一键订阅的免流呢？因为根据你卡的不同，
需要走的免流域名也不同。有些人是钉钉免流，有些人是腾讯免流，有些人是网易免流，
机场主没有神机妙算能算到你是什么卡。而现在很多免流站点都是提供了了订阅转换，这个需要自己稍微配置一下

国外节点为什么都是直连  
其实这个问题在于，免流能用的端口基本都是80端口。
常见的机场，国内中转都不是用的80端口，很多中转机80端口都不给开放的，因为80端口需要备案域名。
但是问题在于，你用中转机中转国外节点，用80端口封的很快。所以说免流机场的国外节点基本都是直连，
好一些的免流机场国外节点可能用的CN2或者cmi，一般来说还是普通线路。而国内免流节点用的80端口没问题，
因为都是国内IP通过国内免流节点访问国内网站，基本不会封

混淆转换网站  
现在很多大的免流机场都提供混淆转换，机场默认提供的免流节点没填入混淆域名，但是通过混淆转换网站，
你将你的v2订阅填写进入以后。在网站里面填写你要使用的混淆域名，以及选择筛选固定端口的节点。
就可以获得填入了混淆和筛选了端口的免流订阅。

这种网站并不是该机场单用的，你甚至可以把别的免流机场的订阅输入进去，进行混淆转换。

这里分享一下：转换.中国国际机场.com

还有直接支持clash的混淆网站，在这里输入v2的免流订阅加上混淆，
直接输出的是clash的国内外免流订阅(但是橘子机场的套餐是国内免流和国外节点分开的，也就是。
你买国内免流套餐只有国内节点。国外套餐只有国外节点。)：https://api.orangeapi.org/

**amy免流**

AMY免流就是可以让没有定向流量的联通卡，走联通沃音乐免流，走公免流量。
电信有的也可以走AMY，一般来说amy就是联通的沃音乐，这家机场还支持电信的爱听，也就是电信也是可以走公免的

**检测IP位置/是否使用VPN网站**

检测是否是VPN/代理/Tor: https://ipinfo.io/  
检测是否存在DNS泄露和是否是原生IP: https://ipleak.net/  
检测IP纯净度: https://scamalytics.com/ip  
检测UserAgent: https://www.google.com/search?q=my+user+agent  
检测WebRTC泄露: https://browserleaks.com/webrtc  

**什么是WebRTC**

WebRTC是一项必要的技术，这样视频聊天和语音应用程序，
如Google Hangouts或Discord，就可以在浏览器上更好更快地运行

WebRTC是指网络实时通信。顾名思义，这种技术允许浏览器之间的实时通信，
而不需要中间服务器(在连接已经建立之后)。WebRTC的优势包括：

- 它缩短了视频聊天、音频聊天、实时流媒体甚至大型文件共享的延迟时间
- 无论是个人还是商业使用，它都是免费的
- 它利用了不断改进的技术
- 它是开源软件，而不是扩展程序或插件
- 它适用于移动应用程序
- 这是群呼服务和网络研讨会的绝佳选择
- 与具有可调节内置麦克风设置的Flash相比，它提供更好的音质

虽然WebRTC最初是由Google开发的，但许多浏览器都支持这项技术，
包括Microsoft Edge、Mozilla Firefox、Opera、GoogleChrome和Safari。

WebRTC 以其增强视频和音频聊天的能力而闻名，但它对于其他应用程序也是一个有用的工具，例如数据传输

**WebRTC泄漏意味着什么？**

WebRTC泄露会导致自己真实IP地址变的可见，这可能给最终用户带来很大的安全风险。
当您试图通过使用带有WebRTC技术的浏览器与其他人建立视频或音频通信时，就会发生WebRTC泄漏
然后浏览器会泄露您的IP地址——这就是为什么它被称为泄露

同时,泄露WebRTC意味着网络运营商知道你在使用VPN或代理并且知道你的真实IPv4和IPv6地址，
同时也知道你电脑上是否安装麦克风,摄像头,还包括显示器分辨率等

**WebRTC泄漏是不可避免的吗？**

只要在您的浏览器中打开WebRTC并且您在使用它的网站上，您的真实IP地址将是公开可见的，因此它会泄漏。
避免WebRTC泄漏的方法是在浏览器中将其关闭或者安装插件（稍后将详细介绍如何执行此操作）

**WebRTC泄漏对谁构成威胁？**

WebRTC泄漏会对使用VPN (虚拟专用网络) 或机场代理/普通代理的任何人构成威胁。
在使用带有WebRTC技术的服务的同时使用VPN有点违背VPN的目的。
问题在于浏览器而不是VPN——正如您稍后将了解到的，当涉及到WebRTC泄漏时，Safari是相当安全的

**如何禁用WebRTC**

我们可以通过安装禁用WebRTC的插件来禁用：  
Chrome: https://chrome.google.com/webstore/detail/webrtc-protect-protect-ip/bkmmlbllpjdpgcgdohbaghfaecnddhni  
Edge: https://microsoftedge.microsoft.com/addons/detail/webrtc-protect-protect-/lnnodkiklhcbkbflgphcklfoiagapkhc  
Firefox: https://addons.mozilla.org/zh-TW/firefox/addon/webrtc-protect/  
Opera: https://addons.opera.com/zh-tw/extensions/details/webrtc-protect/  

然后像这样即可:

<img width="371" alt="XlU5EMjwxl" src="https://github.com/LingLing1301/lingling1301.github.io/assets/65935235/2956c1d4-65c2-41c6-834b-1423a91203c3">

完成后建议到https://browserleaks.com/webrtc 进行测试

**多路复用Mux**

Mux功能是在一条TCP连接上分发多个TCP连接的数据。实现细节详见Mux.Cool。
Mux是为了减少TCP的握手延迟而设计，而非提高连接的吞吐量。使用Mux看视频、下载或者测速通常都有反效果。
Mux只需要在客户端启用，服务器端自动适配

**Strict Route**

"Strict Route"是一种网络路由策略或技术。它通常与IP(Internet Protocol)数据包的处理和转发相关。

在IP数据包的头部，有一个字段叫做"Strict Source Route"(严格源路由)。当该字段被设置为有效时，
IP数据包在转发过程中必须按照该字段指定的路由路径进行严格转发，否则将被丢弃。

具体来说，如果IP数据包的"Strict Source Route"字段有效，数据包将沿着指定的路由路径依次经过每个路由器，
并且每个路由器必须在它的路由表中找到一个完全匹配该路由路径的下一跳地址。
如果在路由过程中遇到无法匹配的路由器或地址，数据包将被丢弃，并且可能返回一个ICMP(Internet Control Message Protocol)
错误消息，通知源主机有关丢弃数据包的情况。

"Strict Route"的使用在现代网络中相对较少见，因为它要求在数据包的头部明确指定整个路由路径，
这样做会带来一些安全和性能上的隐患。通常情况下，网络路由是根据目的地址动态决定下一跳的，而不是事先指定严格的路由路径。
因此，"Strict Route"往往只用于特殊的测试、调试或特定的网络场景中。

严格路由(Strict Route)和严格源路由(Strict Source Route)是两个相关但不同的概念。
严格路由是指数据包必须按照指定路径转发，而严格源路由是指数据包在转发过程中必须经过指定的源地址路径

[参考]

https://docs.cfw.lbyczf.com/contents/urlscheme.html#%E4%B8%8B%E8%BD%BD%E9%85%8D%E7%BD%AE

https://a-nomad.com/clash

https://duangks.com/archives/112/
